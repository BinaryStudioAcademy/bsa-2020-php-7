# Binary Studio Academy 2020 PHP

## Домашнее задание Laravel auth

### Цель
Ознакомиться с механизмами аутентификации и авторизации в Laravel.

### Установка
Установка показана в рабочем окружении OS Linux:
```
git clone git@github.com:BinaryStudioAcademy/bsa-2020-php-7.git
cd bsa-2020-php-7
composer install
cp .env.example .env
php artisan key:generate
php artisan dusk:install
```

### Задание 1
- Создать по роуту `/` главную страницу, содержащую текст: `Marketplace`.
- Добавить возможность регистрации новых пользователей и аутентификации с помощью почты и пароля.
- После аутентификации показывать пользователю страницу со списком товаров `/products`.
- Закрыть доступ ко всем страницам, кроме главной для пользователей, не прошедших аутентификацию.

### Задание 2
Добавить возможность аутентификации через социальную сеть или сервис, например, Фейсбук (Socialite, SocialiteProviders, etc.)
Для этого нужно будет зарегистрировать приложение на используемом ресурсе и использовать предоставленные ключи внутри `.env` Laravel приложения.

### Задание 3
Реализовать механизм авторизации с помощью ролей. 

- Ролей должно быть 2: обычный пользователь и администратор.
- Для хранения роли нужно изменить миграцию для таблицы `users`: добавить флаг `is_admin`.
- Права доступа:
    - Пользователь должен иметь доступ к страницам списка товаров и отдельного товара.
    - Пользователь должен видеть контролы для редактирования и удаления своего товара, а так же добавления нового.
    - Пользователь не должен иметь доступа к соответствующим действиям(обновление, удаление) товара другого пользователя.
    - Администратор должен видеть контролы для редактирования и удаления любого товара, а так же добавление нового и иметь доступ к соответствующим действиям.
- Контроль прав доступа нужно реализовать в классах Policy.
- Проверка критерия предоставления доступа должна происходить в методах класса полиси.
    То есть в контроллерах в итоге должна быть проверка типа
    ```
    if (Gate::denies(‘update', $product)) ...
    ```
    вместо
    ```
    if (Gate::denies(‘isAdmin', $product)) ...
    ```

### Запуск тестов

#### Локально
Допишите порт в `.env`
```
APP_URL=http://localhost:8000
```
Запустите веб сервер
```
php artisan serve --port=8000
```
Запустите тесты
```
php artisan dusk
```

#### Docker
Установите в `.env` строку
```
APP_URL=http://webserver
```
Запустите тесты
```
php artisan dusk
```

#### Запуск тестов c Homestead
Зайдите на виртуальную машину через ssh из папки, где установлен Homestead
```
vagrant ssh
```

Перейдите в директорию проекта и запустите
```
php artisan serve --host=192.168.10.10 --port=8080
```

Установите в `.env` строку
```
APP_URL=http://192.168.10.10:8080
```

Теперь можно запустить тесты.
```
php artisan dusk
```

### Дополнительно
* Документация Dusk - [https://laravel.com/docs/6.x/dusk](https://laravel.com/docs/6.x/dusk)
* Примеры из лекции - [https://github.com/Antarus66/Auth-samples](https://github.com/Antarus66/Auth-samples)
