# Binary Studio Academy 2020 PHP

## Домашнє завдання Laravel auth

### Вимоги
Ознайомитись з механізмами авторизації в Laravel.

### Встановлення
Встановлення показане в робочому середовищі OS Linux:
```
git clone git@github.com:BinaryStudioAcademy/bsa-2020-php-7.git
cd bsa-2020-php-7
composer install
cp .env.example .env
php artisan key:generate
php artisan dusk:install
```

### Завдання 1
- Створити по напрямку `/` головну сторінку, що містить текст: `Marketplace`.
- Додати можливість реєстрації нових користувачів та аутентифікації за допомогою пошти та паролю.
- Після аутентифікації показувати користувачу сторінку зі списком товарів `/products`.
- Закрити доступ до всіх сторінок, крім головної для користувачів, яку не аутентифікувались.

### Завдання 2
Додати можливість аутентифікації за допомогою соціальної мережі або сервісу, наприклад Facebook(Socialite, SocialiteProviders, etc.)
Для цього потрібно зареєструвати додаток на ресурсі який використовується та додати необхідні змінні до `.env` файлу Laravel додатку.

### Завдання 3
Реалізувати механізм авторизації за допомогою ролей.

- Повинно бути 2 ролі: звичайний користувач та адміністратор.
- Для зберігання ролі необхідно змінити міграцію для таблиці `users`: додати поле `is_admin`.
- Права доступу:
    - Користувач повинен мати доступ до сторінок списку товарів та окремого товару.
    - Користувач повинен бачити контроли для редагування та видалення свого товару, а також додавання нового.
    - Користувач не повинен мати доступу до відповідних дій(оновлення, видалення) товару іншого користувача.
    - Адміністратор повинен бачити контроли для редагування та видалення любого товару, а також додавання нового та мати доступ до відповідних дій.
- Контроль прав доступу необхідно реалізувати в класах Policy.
- Перевірка критерію надання доступу повинна відбуватись в методах класу Policy.
    Тобто в контроллерах повинна бути перевірка типу
    ```
    if (Gate::denies(‘update', $product)) ...
    ```
    замість
    ```
    if (Gate::denies(‘isAdmin', $product)) ...
    ```

### Запуск тестів

#### Локально
Додати порт в `.env`
```
APP_URL=http://localhost:8000
```

Запустити веб-сервер
```
php artisan serve --port=8000
```

Запустити тести
```
php artisan dusk
```

#### Docker
Змінити в `.env` значення
```
APP_URL=http://webserver
```
Запустити тести
```
php artisan dusk
```

#### Запуск тестів в Homestead
Змінити в `.env` значення
```
APP_URL=http://192.168.10.10:8080
```

Зайти на віртуальну машину за допомогою ssh з директорії, де встановлений Homestead
```
vagrant ssh
```

Перейти в директорію проекту та запустити
```
php artisan serve --host=192.168.10.10 --port=8080
```

Тепер можна запустити тести
```
php artisan dusk
```

### Додатково
* Документація Dusk - [https://laravel.com/docs/6.x/dusk](https://laravel.com/docs/6.x/dusk)
* Приклади з лекції - [https://github.com/Antarus66/Auth-samples](https://github.com/Antarus66/Auth-samples)
